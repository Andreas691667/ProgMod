class TorqueMotor

types
    public STATE = <Normal> | <Failed>;

instance variables
    private tq_m : real;            --torque from motor  
    private motor_state : STATE;

operations

    public TorqueMotor : () ==> TorqueMotor
    TorqueMotor() == (
        tq_m := 0;
        motor_state := <Normal>;
    );

    public SetTorque : real ==> ()
    SetTorque(tau) == duration(1e5) (
        tq_m := tau;        
    );

    public GetTorque : () ==> real
    GetTorque() == duration(1e4) (
        return tq_m;
    );

    public MotorFailed : () ==> ()
    MotorFailed() == duration(1e8) (
        motor_state := <Failed>;
    );

    public GetMotorState : () ==> STATE
    GetMotorState() == duration(1e4) (
        return motor_state;
    );

    public LockMotor : () ==> ()
    LockMotor() == duration(1e6) (
        tq_m := 0;
    );

    public Step : () ==> ()
    Step() == duration(0) (
        MySystem`env.SetTorque(tq_m);
        MySystem`env.AdjustArmPosition();
    );

    public SetMotorState : (STATE) ==> ()
    SetMotorState(m) == duration(0) (
        motor_state := m;
    )

    thread
        periodic(1e6,0,0,0)(Step);

    sync
        mutex(SetTorque, Step, GetTorque, LockMotor);

end TorqueMotor